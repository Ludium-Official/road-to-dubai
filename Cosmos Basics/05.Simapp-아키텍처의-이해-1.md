# Simapp ì•„í‚¤í…ì²˜ì˜ ì´í•´-1

### Preview

**Hello Earth ğŸŒ!, Welcome to Cosmos ğŸŒŒ**, ì½”ìŠ¤ëª¨ìŠ¤ ë² ì´ì§ ê³¼ì • ë‹¤ì„¯ë²ˆì§¸ ì±•í„°ì— ì˜¨ ê±¸ í™˜ì˜í•œë‹¤.

ìš°ë¦° ì§€ë‚œ ì„¸ë²ˆì§¸ ì‹œê°„ì— ì•± ì²´ì¸ì˜ ë©”ì¸ ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•´ ë°°ì› ê³ , ì˜ì€ ëª¨ë¥´ê² ì§€ë§Œ ì§€ë‚œ ì‹œê°„ì—ëŠ” ê·¸ êµ¬ì„±ìš”ì†Œë“¤ í¬í•¨ëœ ì–´í”Œë¦¬ì¼€ì´ì…˜ simappì„ êµ¬ë™ì‹œì¼°ë‹¤.

ê·¸ëŸ¼ ì´ì œëŠ” ì¼ë‹¨ì€ ëŒì•„ê°€ë˜ ê·¸ ë©”ì¸ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ìˆëŠ”ì§€ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³´ì.

ìš°ì„  ìš°ë¦¬ê°€ ë‹¤ì‹œ ìƒê°í•´ë´ì•¼í•  í¬ì¸íŠ¸ëŠ” Cosmos SDKë¡œ êµ¬í˜„ëœ ì•± ì²´ì¸ì€ ì—¬ëŸ¬ ë ˆì´ì–´ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê°œë°œìë“¤ì´ ì£¼ë¡œ ì‹ ê²½ ì“°ëŠ” ë¶€ë¶„ì€ ë§¨ ìœ„ì˜ state-machine ë ˆë²¨ì´ë¼ëŠ” ê²ƒì´ë‹¤.

ê·¸ë ‡ë‹¤ê³  ê°œë°œìë¡œì„œ ì»¨ì„¼ì„œìŠ¤ ë ˆì´ì–´ íŒŒíŠ¸ë¥¼ ì „í˜€ ì•ˆì“°ì´ëŠ” ê²ƒì€ ì•„ë‹ˆê³  ëŒ€ë¶€ë¶„ ì¸í„°í˜ì´ìŠ¤í™”ê°€ ë˜ì–´ìˆìœ¼ë‹ˆ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë ˆë²¨ì—ì„œ ê°œë°œì„ í•˜ì‹¤ ë•Œ ëª‡ëª‡ íŠ¹ì • ë©”ì†Œë“œê°€ ABCIë€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œ CometBFTë ˆë²¨ë¡œ ì „ë‹¬ë˜ëŠ”êµ¬ë‚˜ ì •ë„ë§Œ ìš°ì„  ì•Œê³  ë„˜ì–´ê°€ë„ë¡ í•˜ì.

```sh
                ^  +-------------------------------+  ^
                |  |                               |  |
                |  |  State-machine = Application  |  |
                |  |                               |  |   Built with Cosmos SDK
                |  |            ^      +           |  |
                |  +----------- | ABCI | ----------+  v
                |  |            +      v           |  ^
                |  |                               |  |
Blockchain Node |  |           Consensus           |  |
                |  |                               |  |
                |  +-------------------------------+  |   CometBFT
                |  |                               |  |
                |  |           Networking          |  |
                |  |                               |  |
                v  +-------------------------------+  v
```

### Simapp ë˜ëŒì•„ë³´ê¸°

ìš°ë¦¬ëŠ” ì´ì „ ì‹œê°„ì— simappì´ë¼ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¤ë£¨ì–´ë³´ì•˜ë‹¤.

í•´ë‹¹ simappì˜ ë°ëª¬ëª…ì¹­ì€ simdì˜€ê³ , `simd start`ë€ ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ simapp ë…¸ë“œ ìš´ì˜ì„ ì‹¤ìŠµí•´ë³´ì•˜ë‹¤.

ê·¸ëŸ¬ë©´ ì´ì œ runningí•´ë³´ì•˜ë˜ í•´ë‹¹ simapp ë…¸ë“œì˜ ì½”ì–´ê°€ ì–´ë–»ê²Œ ë˜ì—ˆëŠ”ì§€ ì¡°ê¸ˆ ë” ë“¤ì—¬ë‹¤ë³´ë„ë¡ í•˜ì.

**ì°¸ê³ ì‚¬í•­**

> Cosmos SDK based ë¸”ë¡ì²´ì¸ í’€ ë…¸ë“œëŠ” ì¼ë°˜ì ìœ¼ë¡œ -dë¡œ ëë‚˜ëŠ” ë°”ì´ë„ˆë¦¬ë¡œ ë‚˜íƒ€ë‚œë‹¤ (ì˜ˆ: appd ë˜ëŠ” gaiad). ì¶”ê°€ë¡œ, ì´ ë°”ì´ë„ˆë¦¬ëŠ” ./cmd/appd/ì— ìˆëŠ” main.go íŒŒì¼ì„ ì‹¤í–‰í•˜ì—¬ ë¹Œë“œëœë‹¤. ì´ ì‘ì—…ì€ ì¼ë°˜ì ìœ¼ë¡œ Makefileì„ í†µí•´ ì´ë£¨ì–´ì§„ë‹¤.

### Simapp ì•„í‚¤í…ì³

ë¨¼ì € simappì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì!

ë­”ê°€ ë”±ë´ë„ ë§ì´ ë³µì¡í•´ë³´ì´ëŠ”ë° ì¼ë‹¨ golangì´ë‹ˆ ì´ êµ¬ì¡°ë¥¼ íŒ¨í‚¤ì§€(ëª¨ë“ˆ) ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ ë³´ëŠ”ê²Œ ì¢€ ë” ì‹¬í”Œí•˜ë‹ˆ

ìš°ì„ ì€ ë„ˆë¬´ ê±±ì •ë§ê³  ë‘ì.

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ app.go
â”œâ”€â”€ app_test.go
â”œâ”€â”€ config.go
â”œâ”€â”€ encoding.go
â”œâ”€â”€ export.go
â”œâ”€â”€ genesis.go
â”œâ”€â”€ genesis_account.go
â”œâ”€â”€ genesis_account_test.go
â”œâ”€â”€ helpers
â”‚   â””â”€â”€ test_helpers.go
â”œâ”€â”€ params
â”‚   â”œâ”€â”€ amino.go
â”‚   â”œâ”€â”€ doc.go
â”‚   â”œâ”€â”€ encoding.go
â”‚   â”œâ”€â”€ params.go
â”‚   â”œâ”€â”€ proto.go
â”‚   â””â”€â”€ weights.go
â”œâ”€â”€ sim_bench_test.go
â”œâ”€â”€ sim_test.go
â”œâ”€â”€ simd
â”‚   â”œâ”€â”€ cmd
â”‚   â”‚   â”œâ”€â”€ cmd_test.go
â”‚   â”‚   â”œâ”€â”€ genaccounts.go
â”‚   â”‚   â”œâ”€â”€ genaccounts_test.go
â”‚   â”‚   â”œâ”€â”€ root.go
â”‚   â”‚   â”œâ”€â”€ testnet.go
â”‚   â”‚   â””â”€â”€ testnet_test.go
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ state.go
â”œâ”€â”€ test_helpers.go
â”œâ”€â”€ types.go
â”œâ”€â”€ utils.go
â””â”€â”€ utils_test.go
```

ê·¸ëŸ¼ ì´ì œ ìœ„ì˜ ë³µì¡í•œ íŒŒì¼ë“¤ì„ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ë¬¶ì–´ë³´ì. ì•„ë§ˆ ì´ì „ë³´ë‹¤ ë” ëˆˆì— í™• ì˜ ë“¤ì–´ì˜¤ê²Œ ë  ê²ƒì´ë‹¤.

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ simapp (*.go)
â”œâ”€â”€ helpers module
â”‚   â””â”€â”€ *.go
â”œâ”€â”€ params module
â”‚   â”œâ”€â”€ *.go
â”œâ”€â”€ simd
â”‚   â”œâ”€â”€ cmd module
â”‚   â”‚   â”œâ”€â”€ *.go
â”‚   â””â”€â”€ main.go (main module, entrypoint)
```

ì´ ìƒíƒœì—ì„œ ìš°ì„  ì§šê³  ë„˜ì–´ê°€ì•¼í•  ë¶€ë¶„ì€ **ì–´ë””ê°€ main module, ì¦‰ entrypointì¸ì§€ì™€ ë©”ì¸ ë¸”ë¡ì²´ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë””ì—ì„œ ì •ì˜ë˜ëŠ” ê²ƒì¸ì§€**ë¥¼ ì²´í¬í•´ë³´ëŠ” ê²ƒì´ë‹¤.

ì•„ë˜ì— êµ¬ì¡°ë“¤ ì¤‘ì— ë‹¹ì—°íˆ main module í•˜ë‚˜ì´ê³ , `simd/main.go`ì—ì„œ ì •ì˜ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆê³ . ë‚˜ë¨¸ì§€ root directoryì— ì¡´ì¬í•˜ë˜ `/*.go` íŒŒì¼ë“¤ì„ì€ simapp ì´ë€ moduleë¡œ ë¬¶ì—¬ì„œ ë‹¤ë£° ì‹¤ì§ˆì ì¸ ì½”ì–´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  helpers, parasm, cmd ê°™ì€ ëª¨ë“ˆë“¤ì€ ê°ê° ìœ í‹¸ë¦¬í‹°ë‚˜ cliì˜ ì»¤ë§¨ë“œë¥¼ ìœ„í•œ ëª¨ë“ˆì´ë¼ëŠ” ê²ƒì„ ìœ ì¶”í•´ë³¼ ìˆ˜ ìˆë‹¤.

**ì°¸ê³ ì‚¬í•­**

> ê·¸ ì¤‘ì— app.goë€ íŒŒì¼ì— ìˆëŠ” ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ ìš°ë¦¬ê°€ ì œë„¤ì‹œìŠ¤ì—ì„œ ì‚¬ìš©í–ˆë˜ ê° ëª¨ë“ˆë“¤ì´ app.goë¼ê³  í•˜ëŠ” app chainì˜ ê¸°ë³¸ êµ¬ì¡°ì²´ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤. ğŸ‘€ ğŸ‘€ ğŸ‘€

### Core application file, app.go

ê·¸ëŸ¼ ì´ì œ ì œì¼ ì¤‘ìš”í•œ core application fileì¸ app.goì— ëŒ€í•´ ë°°ì›Œë³´ë„ë¡ í•˜ì.

#### 1. import modules

`app.go` íŒŒì¼ì„ ë³´ë©´ ì œë„¤ì‹œìŠ¤ì—ì„œ ì‚¬ìš©í–ˆë˜ ê° ëª¨ë“ˆë“¤ì´ ì´ íŒŒì¼ì—ì„œ ì°¸ì¡°ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. `app.go`ì— ì •ì˜ëœ ëª¨ë“ˆë“¤ì´ ê²°êµ­ ìš°ë¦¬ê°€ ë§Œë“¤ í˜¹ì€ ë§Œë“¤ê³ ì í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì²´ì¸ì˜ ê° ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë  ìˆ˜ ìˆìŒì„ ì‹œì‚¬í•œë‹¤.

```go
package simapp

import (
	"encoding/json"
	"io"
	"net/http"
	"os"
	"path/filepath"

	"github.com/gorilla/mux"
	"github.com/rakyll/statik/fs"
	"github.com/spf13/cast"
	abci "github.com/tendermint/tendermint/abci/types"
	"github.com/tendermint/tendermint/libs/log"
	tmos "github.com/tendermint/tendermint/libs/os"
	dbm "github.com/tendermint/tm-db"

	"github.com/cosmos/cosmos-sdk/baseapp"
	"github.com/cosmos/cosmos-sdk/client"
	"github.com/cosmos/cosmos-sdk/client/grpc/tmservice"
	"github.com/cosmos/cosmos-sdk/client/rpc"
	"github.com/cosmos/cosmos-sdk/codec"
	"github.com/cosmos/cosmos-sdk/codec/types"
	"github.com/cosmos/cosmos-sdk/server/api"
	"github.com/cosmos/cosmos-sdk/server/config"
	servertypes "github.com/cosmos/cosmos-sdk/server/types"
	simappparams "github.com/cosmos/cosmos-sdk/simapp/params"
	"github.com/cosmos/cosmos-sdk/testutil/testdata"
	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/cosmos/cosmos-sdk/types/module"
	"github.com/cosmos/cosmos-sdk/version"
	"github.com/cosmos/cosmos-sdk/x/auth"
	"github.com/cosmos/cosmos-sdk/x/auth/ante"
	authrest "github.com/cosmos/cosmos-sdk/x/auth/client/rest"
	authkeeper "github.com/cosmos/cosmos-sdk/x/auth/keeper"
	authsims "github.com/cosmos/cosmos-sdk/x/auth/simulation"
	authtx "github.com/cosmos/cosmos-sdk/x/auth/tx"
	authtypes "github.com/cosmos/cosmos-sdk/x/auth/types"
	"github.com/cosmos/cosmos-sdk/x/auth/vesting"
	vestingtypes "github.com/cosmos/cosmos-sdk/x/auth/vesting/types"
	"github.com/cosmos/cosmos-sdk/x/authz"
	authzkeeper "github.com/cosmos/cosmos-sdk/x/authz/keeper"
	authzmodule "github.com/cosmos/cosmos-sdk/x/authz/module"
	"github.com/cosmos/cosmos-sdk/x/bank"
	bankkeeper "github.com/cosmos/cosmos-sdk/x/bank/keeper"
	banktypes "github.com/cosmos/cosmos-sdk/x/bank/types"
	"github.com/cosmos/cosmos-sdk/x/capability"
	capabilitykeeper "github.com/cosmos/cosmos-sdk/x/capability/keeper"
	capabilitytypes "github.com/cosmos/cosmos-sdk/x/capability/types"
	"github.com/cosmos/cosmos-sdk/x/crisis"
	crisiskeeper "github.com/cosmos/cosmos-sdk/x/crisis/keeper"
	crisistypes "github.com/cosmos/cosmos-sdk/x/crisis/types"
	distr "github.com/cosmos/cosmos-sdk/x/distribution"
	distrclient "github.com/cosmos/cosmos-sdk/x/distribution/client"
	distrkeeper "github.com/cosmos/cosmos-sdk/x/distribution/keeper"
	distrtypes "github.com/cosmos/cosmos-sdk/x/distribution/types"
	"github.com/cosmos/cosmos-sdk/x/evidence"
	evidencekeeper "github.com/cosmos/cosmos-sdk/x/evidence/keeper"
	evidencetypes "github.com/cosmos/cosmos-sdk/x/evidence/types"
	"github.com/cosmos/cosmos-sdk/x/feegrant"
	feegrantkeeper "github.com/cosmos/cosmos-sdk/x/feegrant/keeper"
	feegrantmodule "github.com/cosmos/cosmos-sdk/x/feegrant/module"
	"github.com/cosmos/cosmos-sdk/x/genutil"
	genutiltypes "github.com/cosmos/cosmos-sdk/x/genutil/types"
	"github.com/cosmos/cosmos-sdk/x/gov"
	govkeeper "github.com/cosmos/cosmos-sdk/x/gov/keeper"
	govtypes "github.com/cosmos/cosmos-sdk/x/gov/types"
	"github.com/cosmos/cosmos-sdk/x/mint"
	mintkeeper "github.com/cosmos/cosmos-sdk/x/mint/keeper"
	minttypes "github.com/cosmos/cosmos-sdk/x/mint/types"
	"github.com/cosmos/cosmos-sdk/x/params"
	paramsclient "github.com/cosmos/cosmos-sdk/x/params/client"
	paramskeeper "github.com/cosmos/cosmos-sdk/x/params/keeper"
	paramstypes "github.com/cosmos/cosmos-sdk/x/params/types"
	paramproposal "github.com/cosmos/cosmos-sdk/x/params/types/proposal"
	"github.com/cosmos/cosmos-sdk/x/slashing"
	slashingkeeper "github.com/cosmos/cosmos-sdk/x/slashing/keeper"
	slashingtypes "github.com/cosmos/cosmos-sdk/x/slashing/types"
	"github.com/cosmos/cosmos-sdk/x/staking"
	stakingkeeper "github.com/cosmos/cosmos-sdk/x/staking/keeper"
	stakingtypes "github.com/cosmos/cosmos-sdk/x/staking/types"
	"github.com/cosmos/cosmos-sdk/x/upgrade"
	upgradeclient "github.com/cosmos/cosmos-sdk/x/upgrade/client"
	upgradekeeper "github.com/cosmos/cosmos-sdk/x/upgrade/keeper"
	upgradetypes "github.com/cosmos/cosmos-sdk/x/upgrade/types"

	// unnamed import of statik for swagger UI support
	_ "github.com/cosmos/cosmos-sdk/client/docs/statik"
)
```

ê°€ë ¹ ìš°ë¦¬ê°€ ë§Œë“¤ ì•± ì²´ì¸ì´ ë„ì„œê´€ ì²´ì¸ì´ë¼ê³  ê°€ì •í•˜ì˜€ë‹¤ë©´, ìœ„ì— ìˆëŠ” ì—¬ëŸ¬ import ëœ ëª¨ë“ˆì—ëŠ” ì§€ë‚œë²ˆì— ì–˜ê¸°í–ˆë˜ register module, borrow module, return moduleë“±ì´ ì¡´ì¬í•  ê²ƒì´ë‹¤.

ê·¸ì— ë”°ë¼ì„œ ìš°ë¦° ì´ë ‡ê²Œ í‘œí˜„í•´ë³¼ ìˆ˜ ìˆë‹¤.

> ê·¸ë ‡ë‹¤ë©´, 'ë„ì„œê´€ ì•± ì²´ì¸'ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œê·¸ë¨ë“¤ í•„ìš”í•˜ë‹¤.
>
> 1. íšŒì›ê°€ì… í”„ë¡œê·¸ë¨ (Registration Program)
> 2. ëŒ€ì¶œ í”„ë¡œê·¸ë¨ (Borrowing Program)
> 3. ë°˜ë‚© í”„ë¡œê·¸ë¨ (Returning Program)
>    ê·¸ëŸ¼ ìœ„ì—ì„œ ë³´ì•˜ë˜ application based blockchain ì•„í‚¤í…ì³ë¥¼ ì˜ˆì‹œë¡œ ë“  'ë„ì„œê´€ ì•± ì²´ì¸'ì— ë§ê²Œ ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ì´ë ‡ê²Œ ê·¸ë ¤ì§ˆ ê²ƒì´ë‹¤.

![02_library_app_blockchain](./assets/02_library_app_blockchain.png)

```go
import (
	// something code lines
	// ...
	// ..
	registerkeeper "github.com/cosmos/cosmos-sdk/x/register/keeper"
	registertx "github.com/cosmos/cosmos-sdk/x/register/tx"
	registertypes "github.com/cosmos/cosmos-sdk/x/register/types"

	borrowkeeper "github.com/cosmos/cosmos-sdk/x/borrow/keeper"
	borrowtx "github.com/cosmos/cosmos-sdk/x/borrow/tx"
	borrowtypes "github.com/cosmos/cosmos-sdk/x/borrow/types"

	returnkeeper "github.com/cosmos/cosmos-sdk/x/return/keeper"
	returntx "github.com/cosmos/cosmos-sdk/x/return/tx"
	returntypes "github.com/cosmos/cosmos-sdk/x/register/types"
)
```

#### 2. const & variables

ê·¸ë¦¬ê³  ë‹¤ìŒìœ¼ë¡œëŠ” constì™€ variableì— ëŒ€í•´ì„œ ë³´ì.

ì´ íŒŒíŠ¸ëŠ” simappì´ í‘œì¤€ì€ ì•„ë‹ˆê³  ê° ì²´ì¸ë§ˆë‹¤ ì–´ë–»ê²Œ ì •ì˜í•˜ëƒì˜ ì°¨ì´ë§Œ ìˆë‹¤.

ë¨¼ì €, simappì—ì„œ `app.go` ë‚´ì— ì‚¬ìš©ëœ ì „ì²´ const & variablesì˜ ì½”ë“œ ë¸”ëŸ­ì„ ë³´ê² ë‹¤.

```go
const appName = "SimApp"

var (
	// DefaultNodeHome default home directories for the application daemon
	DefaultNodeHome string

	// ModuleBasics defines the module BasicManager is in charge of setting up basic,
	// non-dependant module elements, such as codec registration
	// and genesis verification.
	ModuleBasics = module.NewBasicManager(
		auth.AppModuleBasic{},
		genutil.AppModuleBasic{},
		bank.AppModuleBasic{},
		capability.AppModuleBasic{},
		staking.AppModuleBasic{},
		mint.AppModuleBasic{},
		distr.AppModuleBasic{},
		gov.NewAppModuleBasic(
			paramsclient.ProposalHandler, distrclient.ProposalHandler, upgradeclient.ProposalHandler, upgradeclient.CancelProposalHandler,
		),
		params.AppModuleBasic{},
		crisis.AppModuleBasic{},
		slashing.AppModuleBasic{},
		feegrantmodule.AppModuleBasic{},
		upgrade.AppModuleBasic{},
		evidence.AppModuleBasic{},
		authzmodule.AppModuleBasic{},
		vesting.AppModuleBasic{},
	)

	// module account permissions
	maccPerms = map[string][]string{
		authtypes.FeeCollectorName:     nil,
		distrtypes.ModuleName:          nil,
		minttypes.ModuleName:           {authtypes.Minter},
		stakingtypes.BondedPoolName:    {authtypes.Burner, authtypes.Staking},
		stakingtypes.NotBondedPoolName: {authtypes.Burner, authtypes.Staking},
		govtypes.ModuleName:            {authtypes.Burner},
	}
)

var (
	_ App                     = (*SimApp)(nil)
	_ servertypes.Application = (*SimApp)(nil)
)

// ... something code lines
// ...
// ...
```

ëŒ€ë¶€ë¶„ì˜ ê²ƒë“¤ì„ ì‰½ê²Œ ë„˜ì–´ê°€ë©´ ë˜ëŠ”ë° `ModuleBasic`ë¥¼ í†µí•´ì„œ ê° ëª¨ë“ˆì´ cosmos-sdk ë ˆë²¨ì—ì„œ ì •ì˜ ëª¨ë“ˆì´ë€ ê¸°ë³¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ ì²´í¬í•˜ê³  ìƒì„±í•´ì£¼ëŠ” ê²ƒì€ ì•Œê³  ë„˜ì–´ê°€ë©´ ëœë‹¤.

```go
func module.NewBasicManager(modules ...module.AppModuleBasic) module.BasicManager

// AppModuleBasic is the standard form for basic non-dependant elements of an application module.
type AppModuleBasic interface {
	Name() string
	RegisterLegacyAminoCodec(*codec.LegacyAmino)
	RegisterInterfaces(codectypes.InterfaceRegistry)

	DefaultGenesis(codec.JSONCodec) json.RawMessage
	ValidateGenesis(codec.JSONCodec, client.TxEncodingConfig, json.RawMessage) error

	// client functionality
	RegisterRESTRoutes(client.Context, *mux.Router)
	RegisterGRPCGatewayRoutes(client.Context, *runtime.ServeMux)
	GetTxCmd() *cobra.Command
	GetQueryCmd() *cobra.Command
}
```

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ íŠ¹ì • ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œì¡±í•˜ëŠ” core application structê°€ ë  ìˆ˜ ìˆë„ë¡ íƒ€ì… ë° ì¸í„°í˜ì´ìŠ¤ ì œí•œë„ ë˜ì–´ìˆë‹¤ëŠ” ì ë„ ì•Œê³  ê°€ë©´ ì¢‹ë‹¤.

```go
var (
	_ App                     = (*SimApp)(nil)
	_ servertypes.Application = (*SimApp)(nil)
)
```

#### 3. simapp struct

ì´ì œ ê·¸ëŸ¼ simapp ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ìš°ë¦¬ê°€ ë‹¤ë¤„ë³´ì•˜ë˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°ì²´ì™€ ë©”ì†Œë“œì— ëŒ€í•´ì„œ ì‚´í´ë³´ì.

ì´ êµ¬ì¡°ì²´ê°€ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì§€ë‚œì‹œê°„ì— ë°°ì› ë˜ run a nodeì—ì„œ `start` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ app.go íŒŒì¼ì— ì •ì˜ëœ state-machine êµ¬ì¡°ì²´ê°€ ì¸ìŠ¤í„´ìŠ¤í™”ê°€ ë˜ëŠ” ê²ƒì„ ëœ»í•œë‹¤.

ìš°ì„  app.go íŒŒì¼ ì•ˆì—ëŠ” êµ‰ì¥íˆ ë§ì€ ì½”ë“œë“¤ì´ ìˆëŠ”ë° ì´ê²ƒë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ë‹¤ ì‚´í´ë³´ê¸° ì „ì— ì´ë ‡ê²Œ outlineì„ ì¡ì•„ì„œ ëŒ€ê°• ì–´ë–¤ ë‚´ìš©ë“¤ì´ ìˆì„ì§€ ìœ ì¶”í•´ë³´ì.

ì•„ë˜ì˜ ê·¸ë¦¼ì€ vscodeë¡œ ì‚´í´ë³¸ `SimApp` ì˜ êµ¬ì¡°ì²´ì™€ Methodsì´ë‹¤. ë­”ê°€ ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ì´ ì¡´ì¬í•  ê²ƒ ê°™ì€ë° í•˜ë‚˜ì”© ì‚´í´ë³´ì.

![alt text](./assets/05_simapp_methods.png)

ë¨¼ì €, ê³„ì†í•´ì„œ ê°•ì¡°í•˜ëŠ” `app.go`ì—ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íƒ€ì… ì •ì˜ì™€ ì´ˆê¸°í™” í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ìˆë‹¤. ìš°ë¦¬ê°€ ë³´ê³  ìˆëŠ” simapp ê°™ì€ cosmos-sdk based application ì˜ íƒ€ì… ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. (ì•± ì²´ì¸ì˜ ê¸°ë³¸ ì •ì˜ë¼ê³  ë³´ë©´ ëœë‹¤)

1. BaseApp ì°¸ì¡° : baseappë¥¼ í™•ì¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì˜ë¡œ baseappì€ ëŒ€ë¶€ë¶„ì˜ í•µì‹¬ ë¡œì§ì„ ì‹¤í˜„í•œë‹¤
2. storage key ë¦¬ìŠ¤íŠ¸ : ê° ëª¨ë“ˆì€ ìì‹ ì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•œë‹¤
3. module manager ë¦¬ìŠ¤íŠ¸ : ê° ëª¨ë“ˆì€ ìì‹ ì˜ keeperë¥¼ ì •ì˜í•˜ì—¬ì•¼ í•œë‹¤
4. appCodec ì°¸ì¡° : ë°ì´í„°ì— ëŒ€í•œ ì½”ë±ìœ¼ë¡œ tx-msgë¥¼ encode & decodeí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œì˜ ì½”ë±ì€ protobuf ì½”ë±ì„ ì˜ë¯¸í•œë‹¤
5. legacyAmino ì¸ì½”ë” ì°¸ì¡° : protobufê³¼ ê°™ì€ ì½”ë±ì´ ì“°ì´ê¸° ì´ì „ì˜ ë ˆê±°ì‹œ ì½”ë±ì´ aminoì´ë‹¤
6. ëª¨ë“ˆ ê´€ë¦¬ìì™€ ê¸°ë³¸ ëª¨ë“ˆ ê´€ë¦¬ì : ëª¨ë“ˆì„ ê´€ë¦¬í•˜ê³ , í•„ìš”í•œ ì„œë¹„ìŠ¤ì™€ ì¿¼ë¦¬ ì„œë¹„ìŠ¤ ë“±ì„ ë“±ë¡í•œë‹¤

**(ì¥í™©í•˜ê²Œ ë§ê³  ê°‘ìê¸° ì–´ë ¤ìš´ ë‹¨ì–´ë“¤ì´ ë¶ˆì‘¥ íŠ€ì–´ë‚˜ì™”ë‹¤ê³  í•´ì„œ ê±±ì •í•  í•„ìš”ëŠ” ì—†ë‹¤ ì–´ì°¨í”¼ ê³„ì†í•´ì„œ ë³´ë‹¤ë³´ë©´ ì ì  ë¨¸ë¦¿ì†ì—ì„œ ê°œë…ë“¤ì´ ì¡í˜€ë‚˜ê°ˆ ê²ƒì´ë‹¤ ë¬´ë¦¬í•´ì„œ ì´í•´í•˜ë ¤í•˜ì§€ ë§ê³ ! ë°˜ë“œì‹œ ê·¸ëƒ¥ ë°›ì•„ë“œë ¤ë¼)**

ref; https://docs.cosmos.network/v0.47/learn/beginner/overview-app

ì, ê·¸ëŸ¼ ìœ„ì— êµ¬ì„±ìš”ì†Œê°€ ë‹´ê¸´ core application simappì˜ app.go ë¥¼ ì‚´í´ë³´ì

```go
// SimApp extends an ABCI application, but with most of its parameters exported.
// They are exported for convenience in creating helper functions, as object
// capabilities aren't needed for testing.
type SimApp structure {
	*baseapp.BaseApp
	legacyAmino *codec.LegacyAmino
	appCodec codec.Codec
	interfaceRegistry types.InterfaceRegistry

	invCheckPeriod uint

	// keys to access the substores
	keys map[string]*storetypes.KVStoreKey
	tkeys map[string]*storetypes.TransientStoreKey
	memKeys map[string]*storetypes.MemoryStoreKey

	// keeps
	AccountKeeper authkeeper.AccountKeeper
	BankKeeper bankkeeper.Keeper
	CapabilityKeeper *capabilitykeeper.Keeper
	StakingKeeper stakingkeeper.Keeper
	SlashingKeeper slashingkeeper.Keeper
	MintKeeper mintkeeper.Keeper
	DistrKeeper distrkeeper.Keeper
	GovKeeper govkeeper.Keeper
	CrisisKeeper crisiskeeper.Keeper
	UpgradeKeeper upgradekeeper.Keeper
	ParamsKeeper paramskeeper.Keeper
	AuthzKeeper authzkeeper.Keeper
	EvidenceKeeper evidencekeeper.Keeper
	FeeGrantKeeper feegrantkeeper.Keeper
	GroupKeeper groupkeeper.Keeper
	NFTKeeper nftkeeper.Keeper

	// the module manager
	mm *module.Manager

	// simulation manager
	sm *module.SimulationManager

	// module configurator
	configurator module. Configurator
}
```

ë­”ê°€ ë‚´ìš©ì´ ë§ì€ë° í•œë²ˆì— ë‹¤ ì•ˆë“¤ì–´ì˜¬í…Œë‹ˆ ì—¬ê¸°ì„œëŠ” ì´ëŸ° ìœ„ì—ì„œ ë°°ìš´ 6ê°€ì§€ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì–´ë–»ê²Œ ë°°ì¹˜ë˜ì–´ìˆëŠ”ì§€ ëˆˆìœ¼ë¡œ í›‘ëŠ” ì •ë„ë§Œ í•˜ê³  ë„˜ì–´ê°€ë³´ì.

### Appchain Initiate Method (NewSimApp)

ìœ„ì—ì„œ ë°°ìš´ ë³µì¡í•œ êµ¬ì¡°ì²´ì¸ `SimApp` structëŠ” ì¼ë‹¨ instanciate í•´ì¤„ create methodê°€ í•„ìš”í•˜ë‹¤.

ìš°ë¦¬ëŠ” ì´ê±¸ `NewSimApp`ì´ë€ í•¨ìˆ˜ë¡œ ì •ì˜í•œë‹¤. ì´ NewSimAppê³¼ ê°™ì€ ì•±ì²´ì¸ êµ¬ì¡°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ëŠ” cosmos-sdkì—ì„œ `AppCreator`ë¼ê³  ë¶€ë¥¸ë‹¤.

AppCreator funcì„ í†µí•´ì„œ ì‹¤ì œ structë¥¼ ì´ì œ instanceì‹œí‚¬ ìˆ˜ ìˆëŠ” functionì˜ signatureë¥¼ ë§Œë“¤ì–´ì¤€ê±°ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

#### AppCreator Signature

> This function constructs a new application with the type defined in the previous section. It must meet the AppCreator signature to be used in the start order of the application guardian program order.

```go
// AppCreator is a function that allows us to lazily initialize an
// application using various configurations.
AppCreator func(log.Logger, dbm.DB, io.Writer, AppOptions) Application
```

### NewSimApp Method

ìœ„ì—ì„œ ì •ì˜í•œ simappì„ initiate í•´ì£¼ëŠ” NewApp(AppCreator)ë¥¼ ë‹¤ ë§Œë“¤ê³  ë³´ë©´ ì¢€ ë³µì¡í•˜ê¸° ë•Œë¬¸ì— ì´ë²ˆ ì‹œê°„ì—ëŠ” ê°„ëµíˆë§Œ í›‘ê³  ë„˜ì–´ê°€ë„ë¡ í•˜ê² ë‹¤.

ë‹¤ë§Œ ìœ„ì—ì„œ ë§í–ˆë˜ 1~6ë²ˆ ê¸°ëŠ¥ë“¤ì´ ì•„ë˜ì— ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ìˆëŠ”ì§€ ì •ë„ë§Œ ì‚´ì§ ë§ì¶°ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

> 1. BaseApp ì°¸ì¡° : baseappë¥¼ í™•ì¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì˜ë¡œ baseappì€ ëŒ€ë¶€ë¶„ì˜ í•µì‹¬ ë¡œì§ì„ ì‹¤í˜„í•œë‹¤
> 2. storage key ë¦¬ìŠ¤íŠ¸ : ê° ëª¨ë“ˆì€ ìì‹ ì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•œë‹¤
> 3. module manager ë¦¬ìŠ¤íŠ¸ : ê° ëª¨ë“ˆì€ ìì‹ ì˜ keeperë¥¼ ì •ì˜í•˜ì—¬ì•¼ í•œë‹¤
> 4. appCodec ì°¸ì¡° : ë°ì´í„°ì— ëŒ€í•œ ì½”ë±ìœ¼ë¡œ tx-msgë¥¼ encode & decodeí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œì˜ ì½”ë±ì€ > protobuf ì½”ë±ì„ ì˜ë¯¸í•œë‹¤
> 5. legacyAmino ì¸ì½”ë” ì°¸ì¡° : protobufê³¼ ê°™ì€ ì½”ë±ì´ ì“°ì´ê¸° ì´ì „ì˜ ë ˆê±°ì‹œ ì½”ë±ì´ aminoì´ë‹¤
> 6. ëª¨ë“ˆ ê´€ë¦¬ìì™€ ê¸°ë³¸ ëª¨ë“ˆ ê´€ë¦¬ì : ëª¨ë“ˆì„ ê´€ë¦¬í•˜ê³ , í•„ìš”í•œ ì„œë¹„ìŠ¤ì™€ ì¿¼ë¦¬ ì„œë¹„ìŠ¤ ë“±ì„ ë“±ë¡í•œë‹¤

```go
// NewSimApp returns a reference to an initialized SimApp.
func NewSimApp(
	logger log.Logger, db dbm.DB, traceStore io.Writer, loadLatest bool, skipUpgradeHeights map[int64]bool,
	homePath string, invCheckPeriod uint, encodingConfig simappparams.EncodingConfig,
	appOpts servertypes.AppOptions, baseAppOptions ...func(*baseapp.BaseApp),
) *SimApp {
	appCodec:= encodingConfig.Codec
	legacyAmino:= encodingConfig.Amino
	interfaceRegistry:= encodingConfig.InterfaceRegistry

	bApp:= baseapp.NewBaseApp(appName, logger, db, encodingConfig.TxConfig.TxDecoder(), baseAppOptions..)
	bApp. SetCommitMultiStoreTracer(traceStore)
	bApp.SetVersion(version.Version)
	bApp.SetInterfaceRegistry(interfaceRegistry)

	keys:= sdk.NewKVStoreKeys(
		authtypes.StoreKey, banktypes.StoreKey, stakingtypes.StoreKey,
		minttypes.StoreKey, districts.StoreKey, slashingtypes.StoreKey,
		govtypes.StoreKey, paramstypes.StoreKey, upgradetypes.StoreKey, feegrant.StoreKey,
		evidencepes.StoreKey, capabilitytypes.StoreKey,
		authzkeeper.StoreKey, nftkeeper.StoreKey, group.StoreKey,
	)
	tkeys:= sdk.NewTransientStoreKeys(paramstypes.TStoreKey)
	// NOTE: The testingkey is just mounted for testing purposes. Actual applications should
	// not include this key.
	memKeys:= sdk.NewMemoryStoreKeys(capabilitytypes.MemStoreKey, "testingkey")

	// configure state listening capabilities using AppOptions
	// we are doing nothing with the returned streaming Services and waitGroup in this case
	if _, _, err:= streaming.LoadStreamingServices(bApp, appOpts, appCodec, keys); err != nil {
		tmos.Exit(err.Error())
	}

	app:= &SimApp{
		BaseApp: bApp,
		legacyAmino: legacyAmino,
		appCodec: appCodec,
		interfaceRegistry: interfaceRegistry,
		invCheckPeriod: invCheckPeriod,
		keys: keys,
		tkeys: tkeys,
		memKeys: memKeys,
	}
	// set the BaseApp's parameter store

	// ..
	// ..
	// .. skipped some code bases
	// ..
	// ê½¤ ë§ì€ ì½”ë“œë“¤ì´ ìƒëµë˜ì—ˆìŒ.

	return app
}
```

### Appchain Method

ê·¸ëŸ¼ ìœ„ì—ì„œ ë³´ì•˜ë˜ ë‹¤ë¥¸ `SimApp` êµ¬ì¡°ì²´ê°€ cosmos-sdk based baseappì´ ë˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œì¡±í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ë©”ì†Œë“œë“¤ì„ ì‚´í´ë³´ì.

í•´ë‹¹ ë©”ì†Œë“œë“¤ì€ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ê²½í–¥ì´ ìˆê¸´ í•˜ë‚˜ ê·¸ë˜ë„ ì¼ë‹¨ cosmos-sdk based ì²´ì¸ë“¤ì´ë¼ë©´ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼í•˜ëŠ” ë©”ì†Œë“œë“¤ì´ë‹¤.

ì´ëŸ° ë©”ì†Œë“œë“¤ì€ ì €í¬ëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì•„ë˜ì™€ ê°™ì€ outlineìœ¼ë¡œ ë°°ì› ë‹¤.

![alt text](./assets/05_simapp_methods.png)

#### InitChainer

ë¨¼ì €, ì²«ë²ˆì§¸ë¡œ ë‹¤ë£° ë©”ì†Œë“œëŠ” `InitChainer` í•¨ìˆ˜ì´ë‹¤.

ì´ ë…€ì„ì´ í•´ì£¼ëŠ” ì—­í• ì€ ê²°êµ­ì— 0ë²ˆì§¸ ë¸”ë¡ì„ ì‹¤í–‰ì‹œì¼œì„œ ì²«ë²ˆì§¸ ë¸”ë¡ì€ block1ì„ ìœ„í•œ ìŠ¤í…Œì´íŠ¸ë¥¼ inití•´ì£¼ëŠ” ê±¸ ëœ»í•œë‹¤.

ìš°ë¦¬ê°€ ì§€ë‚œ ì‹œê°„ì— gentxë¥¼ ë§Œë“¤ì–´ì„œ genesisì— ë„£ì—ˆë˜ê²Œ ê·¸ íŒŒíŠ¸ì˜ ì—°ì¥ìœ¼ë¡œ, ë§Œì•½ ê·¸ ê³¼ì •ì—ì„œ stakingì„ ì•ˆí–ˆë‹¤ë©´ initChainerë¡œë¶€í„° ì—ëŸ¬ë¥¼ ë°›ê²Œ ë  ê²ƒì´ë‹¤.

ê·¸ë¦¬ê³  ë§Œì•½ ì œë„¤ì‹œìŠ¤ì— ì˜¬ë°”ë¥´ì§€ ì•Šì€ signature txsê°€ ìˆë”ë¼ë„ ë§ˆì°¬ê°€ì§€ë‹¤.

```go
// InitChainer application update at chain initialization
func (app *SimApp) InitChainer(ctx sdk.Context, req abci.RequestInitChain) abci.ResponseInitChain {
	var genesisState GenesisState
	if err:= json.Unmarshal(req.AppStateBytes, &genesisState); err != nil {
		panic(err)
	}
	app.UpgradeKeeper.SetModuleVersionMap(ctx, app.mm.GetVersionMap())
	return app.mm.InitGenesis(ctx, app.appCodec, genesisState)
}
```

#### BeginBlocker and EndBlocker

ë‹¤ìŒìœ¼ë¡œ ë‹¤ë£° ë©”ì†Œë“œëŠ” beginblocker & endblockerì´ë‹¤. ê·¸ ì˜ë¯¸ëŠ” ë§ ê·¸ëŒ€ë¡œ ë¸”ë¡ì´ ìƒì„±ë˜ê¸° ì „ê³¼ í›„ì— ë™ì‘í•˜ëŠ” hookì´ë¼ê³  ë³´ë©´ ëœë‹¤. ê°€ì¥ ì‰¬ìš´ ì˜ˆë¡œ ì¸í”Œë ˆì´ì…˜ì´ ì¡´ì¬í•˜ëŠ” ì½”ìŠ¤ëª¨ìŠ¤ ì²´ì¸ì€ beginblockì— mintë€ ëª¨ë“ˆì´ í† í°ì„ ìƒì„±í•˜ëŠ” í›…ì´ ì¡´ì¬í•œë‹¤.

ì´ ë©”ì†Œë“œë“¤ì€ Cosmos-SDKì— ìˆì–´ì„œ êµ‰ì¥íˆ ìœ ë‹ˆí¬í•˜ê³  ì¬ë¯¸ë‚œ í¬ì¸íŠ¸ì´ë‹¤.

ì‚¬ì‹¤ ë‹¤ë¥¸ ethereumê³¼ ê°™ì€ ì²´ì¸ë“¤ì—ë„ ë¹„ìŠ·í•œ logicì´ë‚˜ componentê°€ ìˆëŠ”ì§€ ì •í™•íˆ ëª¨ë¥´ê² ì§€ë§Œ! ì´ íŒŒíŠ¸ê°€ ë§¤ë ¥ì ì´ì–´ì„œ ì½”ìŠ¤ëª¨ìŠ¤ë¡œ ë„˜ì–´ì˜¨ ì²´ì¸ë“¤ë„ ê½¤ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

([injective](https://youtu.be/p3rK4rBmy9U?si=vrXHiVzsTx-de-Dt)ì™€ ê°™ì€ ì²´ì¸ì´ ì´ endblockerë¥¼ í†µí•´ì„œ ì¬ë°ŒëŠ” ë¡œì§ì„ ë„£ì–´ì„œ dex applicationì„ ë” ìµœì í™” ì‹œì¼°ë˜ ê²ƒìœ¼ë¡œ ê¸°ì–µí•œë‹¤, ì•„! ê·¸ë¦¬ê³  dydxë„ ìˆë‹¤)

ë§í•˜ê³ ì í•˜ëŠ” ì˜ì˜ëŠ” ê²°êµ­ dappë“¤ì´ ì²´ì¸ì˜ ë¸”ë¡ í”„ë¡œë“€ì‹±ê³¼ ê°™ì€ ì½”ì–´ ë ˆë²¨ ë‹¨ì—ì„œ ê° ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹ˆì¦ˆì— ì˜í•´ì„œ L2(Layer2)ë‚˜ ë‹¤ë¥¸ ecocsytemì˜ general purpose vm applicationì—ì„œ soverign applicationìœ¼ë¡œ ì „í™˜í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ê° `BeginBlocker`ì™€ `EndBlocker`ëŠ” ì•„ë˜ì™€ ê°™ì€ ë‹¨ìˆœí•œ í•¨ìˆ˜ì´ì§€ë§Œ í•´ë‹¹ í•¨ìˆ˜ë“¤ì— ë‚´í¬ëœ ì‹¤ì§ˆì ì¸ ë¡œì§ë“¤ì€ ê° ëª¨ë“ˆë ˆë²¨ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì¼ë‹¨ ìŠ¤í‚µí•˜ê³  ë„˜ì–´ê°€ì.

ë‹¨! ìš°ë¦¬ê°€ ì•Œì•„ì•¼í•  ì ë“¤ì€ cosmos-sdkë¡œ êµ¬í˜„ëœ ì•±ì²´ì¸ë“¤ì—ëŠ” ê° ì²´ì¸ë§ˆë‹¤ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë§ì¶°ì„œ ë¸”ë¡ ìƒì„± ì „ê³¼ í›„ì˜ ì–´ë– í•œ ë¡œì§ì„ ë…¹ì—¬ë‚¼ ìˆ˜ ìˆë‹¤ë¼ëŠ” ì ì´ ì¢‹ì€ í¬ì¸íŠ¸ë¡œ ì•Œê³  ë„˜ì–´ê°€ì‹œë©´ ì¢‹ê² ë‹¤.

```go
// BeginBlocker application updates every begin block
func (app *SimApp) BeginBlocker(ctx sdk.Context, req abci.RequestBeginBlock) abci.ResponseBeginBlock {
	return app.mm.BeginBlock(ctx, req)
}

// EndBlocker application updates every end block
func (app *SimApp) EndBlocker(ctx sdk.Context, req abci.RequestEndBlock) abci.ResponseEndBlock {
	return app.mm.EndBlock(ctx, req)
}
```

#### Registered encoder

ì½”ë±ì€ ë§ ê·¸ëŒ€ë¡œ ì½”ë±ì´ë‹¤.

ê·¸ë ‡ì§€ë§Œ ì•„ë§ˆë„ ì—¬ê¸°ì— ì½”ë±ì˜ ì˜ë¯¸ìì²´ê°€ í¬ê²Œ ì™€ë‹¿ì§€ ì•ŠëŠ” ê°œë°œìë¶„ë“¤ë„ ìˆìœ¼ì‹¤ ê²ƒ ê°™ë‹¤.

ì‰½ê²Œ ë§í•´ ë¸”ë¡ì²´ì¸ì€ ê³„ì†í•´ì„œ ì–´ë– í•œ ìƒíƒœê°’ì„ í‚¤-ë°¸ë¥˜ë¡œ ì €ì¥í•´ì•¼í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì¸ë°, ì´ ë•Œë¬¸ì— ê°€ê¸‰ì ì´ë©´ ìµœì†Œí•œì˜ ë¹„ìš©(ì‘ì€ í¬ê¸°)ë¡œ ê°ê°ì˜ ë¸”ë¡ì²´ì¸ì— ëŒ€í•œ statementë¥¼ êµ¬ì„±í•˜ê³  ì—…ë°ì´íŠ¸í•˜ë ¤ê³  í•œë‹¤.

ê·¸ë˜ì„œ ëŒ€ë¶€ë¶„ì˜ ë¸”ë¡ì²´ì¸ì—ì„œëŠ” ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥í•˜ì§€ ì•Šê³  ê° ì²´ì¸ë§ˆë‹¤ì˜ ì½”ë±ìœ¼ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì••ì¶•ëœ bytes arrayë¡œ ì €ì¥í•˜ê²Œ ëœë‹¤.

cosmos-sdkì—ì„œëŠ” ì´ëŸ° ì´ìœ ë¡œ codecìœ¼ë¡œ protobuf en&decoderë¥¼ ì‚¬ìš©í•˜ëŠ”ë°
(protobufì´ ë¬´ì—‡ì¸ì§€ëŠ” ë‚˜ì¤‘ì— ë°°ìš¸í…Œë‹ˆ ë„˜ì–´ê°€ë©´ ëœë‹¤!)

ëª¨ë“  íƒ€ì…ì˜ ë©”ì„¸ì§€ë¥¼ ì½”ë±ìœ¼ë¡œ ì§€ì›í•  ìˆ˜ë„ ì—†ê³ , ì•…ì˜ì ì¸ í˜•íƒœì˜ ë©”ì„¸ì§€ê°€ ìš”ì²­ë  ìˆ˜ ìˆê¸°ë„ í•˜ê¸° ë•Œë¬¸ì— `InterfaceRegistry`ë€ Registryë¥¼ ë§Œë“¤ì–´ íŠ¹ì • ë©”ì„¸ì§€ë“¤ë§Œ ìš”ì²­ë  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

> InterfaceRegistry. InterfaceRegistry is used by Protobuf encoder to handle the interface of using google.protobuf.Any for coding and decoding ï¼ˆ We also say â€œ unpacking â€ï¼‰.

ì´ëŸ° ë¶€ë¶„ ë•Œë¬¸ì— ê° ì²´ì¸ë§ˆë‹¤ `EncodingConfig` structì—ëŠ” registryì™€ codecì´ ê°™ì´ ì¡´ì¬í•œë‹¤. ì´ë•Œ ì½”ë±ì´ 2ê°œì¸ ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆëŠ”ë° ìœ„ì—ì„œë„ ë§í–ˆë‹¤ì‹œí”¼ AminoëŠ” ë ˆê±°ì‹œ ì½”ë±ì´ê³ , codecí˜¹ì€ marshalerê°€ í˜„ì¬ ì£¼ë¡œ ì“°ì´ëŠ” protobufê¸°ë°˜ì˜ ì½”ë±ì´ë‹¤.

- Codec: The default coder used by the entire Cosmos SDK. It consists of BinaryCodec for coding and decoding status and JSONCodec for exporting data to users ï¼ˆ for example ï¼‰ in CLI. In the default case, SDK uses Protobuf as a encoder.

- TxConfig: TxConfig defines an interface where the client can use it to generate a specific transaction type defined by the application. Currently, SDK handles two types of transactions: SIGN_MODE_DIRECTï¼ˆ uses Protobuf binary as an online code ï¼‰ and SIGN_MODE_LEGACY_AMINO_JSONï¼ˆ relies on Aminoï¼‰.

```go
// EncodingConfig specifies the concrete encoding types to use for a given app.
// This is provided for compatibility between protobuf and amino implementations.
type EncodingConfig struct {
	InterfaceRegistry types. InterfaceRegistry
	Codec codec. Codec
	TxConfig client. TxConfig
	Amino *codec.LegacyAmino
}
```

**ì°¸ê³ ì‚¬í•­**
ì½”ìŠ¤ëª¨ìŠ¤ ìƒíƒœê³„ì—ëŠ” EIPì²˜ëŸ¼ ADRì´ë¼ê³  í•˜ëŠ” ìŠ¤íƒ ë‹¤ë“œ ë¬¸ì„œê°€ ì¡´ì¬í•œë‹¤. ê·¸ë¦¬ê³  ì´ ë¬¸ì„œì™€ ê±°ë²„ë„ŒìŠ¤ë¥¼ í†µí•´ì„œ ì´ì „ì— protobufë¥¼ ì½”ë±ìœ¼ë¡œ ì‚¬ìš©í•˜ìëŠ” [ì˜ê²¬ì´ ì±„íƒë˜ì–´](https://github.com/cosmos/cosmos-sdk/blob/main/docs/architecture/adr-019-protobuf-state-encoding.md) í˜„ì¬ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²ƒì´ë‹¤.

í’€ ë„¤ì„ì€ Architecture Decision Records ë¥¼ ADRì´ë¼ê³  í•˜ê³ , ë‹¤ë¥¸ í”„ë¡œí† ì½œì—ì„œì˜ EIP ê°™ì€ ê±°ë¼ê³  ë³´ë©´ëœë‹¤.

### Baseapp

ëìœ¼ë¡œ baseapp ì— ëŒ€í•´ì„œë§Œ ê°„ë‹¨íˆ ì–˜ê¸°í•˜ê³  ì´ ë ‰ì³ë¥¼ ë§ˆë¬´ë¦¬í•˜ì.

BaseAppì€ Cosmos SDK ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬í˜„í•˜ëŠ” ê¸°ë³¸ êµ¬ì¡°ì²´ë¡œ, simappë„ í•´ë‹¹ baseappì˜ í™•ì¥ëœ êµ¬ì¡°ì²´ì´ë‹¤.

ì´ baseapp ìœ í˜•ì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í•œë‹¤.

```go
type App struct {
  // reference to a BaseApp
  *baseapp.BaseApp

  // list of application store keys

  // list of application keepers

  // module manager
}

```

- 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¸”ë¡ ë§í¬ëŠ” ìƒíƒœ ë¨¸ì‹ ê³¼ í•˜ë¶€ í•©ì˜ ì—”ì§„(ì˜ˆ: Tendermint) ê°„ì˜ í†µì‹ ì„ ìœ„í•´ ì‚¬ìš©
- 2. ì„œë¹„ìŠ¤ ë¼ìš°í„°ëŠ” ë©”ì‹œì§€ì™€ ì¿¼ë¦¬ë¥¼ ì ì ˆí•œ ëª¨ë“ˆë¡œ ë¼ìš°íŒ…
- 3. ë‹¤ë¥¸ ìƒíƒœë“¤, ìƒíƒœ ë¨¸ì‹ ì€ ìˆ˜ì‹ í•œ ABCI ë©”ì‹œì§€ì— ë”°ë¼ ë‹¤ì–‘í•œ ë³€ë™ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
- 4. BaseAppì˜ ëª©í‘œëŠ” Cosmos SDK ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ ë ˆì´ì–´ë¥¼ ì œê³µí•˜ì—¬, ê°œë°œìê°€ ì‰½ê²Œ í™•ì¥í•˜ì—¬ ìì‹ ë§Œì˜ ì‚¬ìš©ì ì •ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•. ì¼ë°˜ì ìœ¼ë¡œ ê°œë°œìëŠ” ìì‹ ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ ì‚¬ìš©ì ì •ì˜ íƒ€ì…ì„ ìƒì„±.

ë§ˆì§€ë§‰ìœ¼ë¡œ ì•„ë˜ëŠ” BaseAppì˜ structì¸ë° í•´ë‹¹ êµ¬ì¡°ì²´ì—ì„œ ë´¤ë“¯ì´, ì´ëŸ¬í•œ ë°˜ë³µë˜ê³  ê° ì²´ì¸ì—ì„œ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ë¡œ ì´ë¤„ì ¸ì•¼í•  ê³¼ì •ë“¤ì´ ì´ë¯¸ BaseAppì— êµ¬í˜„ë˜ì–´ìˆê±°ë‚˜ êµ¬í˜„í•˜ë„ë¡ ì¸í„°í˜ì´ìŠ¤ê°€ ì •ì˜ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—.

ìš°ë¦¬ ê°œë°œìë“¤ì€ ABCI êµ¬í˜„, ì„œë¹„ìŠ¤ ë¼ìš°í„°, ìƒíƒœ ê´€ë¦¬ ë¡œì§ì— ëŒ€í•´ ì‹ ê²½ ì“°ì§€ ì•Šê³  ìì‹ ì´ ì›í•˜ëŠ” ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ ì‚¬ìš©ì ì •ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

```go
// BaseApp reflects the ABCI application implementation.
type BaseApp struct { // nolint: maligned
	// initialized on creation
	logger            log.Logger
	name              string               // application name from abci.Info
	db                dbm.DB               // common DB backend
	cms               sdk.CommitMultiStore // Main (uncached) state
	storeLoader       StoreLoader          // function to handle store loading, may be overridden with SetStoreLoader()
	router            sdk.Router           // handle any kind of message
	queryRouter       sdk.QueryRouter      // router for redirecting query calls
	grpcQueryRouter   *GRPCQueryRouter     // router for redirecting gRPC query calls
	msgServiceRouter  *MsgServiceRouter    // router for redirecting Msg service messages
	interfaceRegistry types.InterfaceRegistry
	txDecoder         sdk.TxDecoder // unmarshal []byte into sdk.Tx

	anteHandler    sdk.AnteHandler  // ante handler for fee and auth
	initChainer    sdk.InitChainer  // initialize state with validators and state blob
	beginBlocker   sdk.BeginBlocker // logic to run before any txs
	endBlocker     sdk.EndBlocker   // logic to run after all txs, and to determine valset changes
	addrPeerFilter sdk.PeerFilter   // filter peers by address and port
	idPeerFilter   sdk.PeerFilter   // filter peers by node ID
	fauxMerkleMode bool             // if true, IAVL MountStores uses MountStoresDB for simulation speed.

	// manages snapshots, i.e. dumps of app state at certain intervals
	snapshotManager    *snapshots.Manager
	snapshotInterval   uint64 // block interval between state sync snapshots
	snapshotKeepRecent uint32 // recent state sync snapshots to keep

	// volatile states:
	//
	// checkState is set on InitChain and reset on Commit
	// deliverState is set on InitChain and BeginBlock and set to nil on Commit
	checkState   *state // for CheckTx
	deliverState *state // for DeliverTx

	// an inter-block write-through cache provided to the context during deliverState
	interBlockCache sdk.MultiStorePersistentCache

	// absent validators from begin block
	voteInfos []abci.VoteInfo

	// paramStore is used to query for ABCI consensus parameters from an
	// application parameter store.
	paramStore ParamStore

	// The minimum gas prices a validator is willing to accept for processing a
	// transaction. This is mainly used for DoS and spam prevention.
	minGasPrices sdk.DecCoins

	// initialHeight is the initial height at which we start the baseapp
	initialHeight int64

	// flag for sealing options and parameters to a BaseApp
	sealed bool

	// block height at which to halt the chain and gracefully shutdown
	haltHeight uint64

	// minimum block time (in Unix seconds) at which to halt the chain and gracefully shutdown
	haltTime uint64

	// minRetainBlocks defines the minimum block height offset from the current
	// block being committed, such that all blocks past this offset are pruned
	// from Tendermint. It is used as part of the process of determining the
	// ResponseCommit.RetainHeight value during ABCI Commit. A value of 0 indicates
	// that no blocks should be pruned.
	//
	// Note: Tendermint block pruning is dependant on this parameter in conunction
	// with the unbonding (safety threshold) period, state pruning and state sync
	// snapshot parameters to determine the correct minimum value of
	// ResponseCommit.RetainHeight.
	minRetainBlocks uint64

	// application's version string
	appVersion string

	// recovery handler for app.runTx method
	runTxRecoveryMiddleware recoveryMiddleware

	// trace set will return full stack traces for errors in ABCI Log field
	trace bool

	// indexEvents defines the set of events in the form {eventType}.{attributeKey},
	// which informs Tendermint what to index. If empty, all events will be indexed.
	indexEvents map[string]struct{}
}
```

#### References

https://docs.cosmos.network/v0.50/learn/beginner/app-anatomy
https://docs.cosmos.network/v0.45/core/baseapp.html
